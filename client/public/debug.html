<!DOCTYPE html>
<html>
<head>
    <title>Debug Login Test - BJJ Journal</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        input, button { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .debug { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; margin: 5px 0; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü•ã BJJ Journal - Debug Login</h1>
        <p>This is a simple test to check if the login API is working.</p>
        
        <form id="loginForm">
            <input type="email" id="email" placeholder="Email" value="test@example.com" required>
            <input type="password" id="password" placeholder="Password" value="password123" required>
            <button type="submit">Test Login</button>
        </form>
        
        <div id="result"></div>
        <div id="debugLog"></div>
    </div>
    
    <script>
        function addDebug(message) {
            const debugLog = document.getElementById('debugLog');
            const div = document.createElement('div');
            div.className = 'debug';
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            debugLog.appendChild(div);
            console.log(message);
        }
        
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const result = document.getElementById('result');
            
            addDebug('Form submitted, starting login test...');
            addDebug('Email: ' + email);
            addDebug('Password: ' + (password ? '[PROVIDED]' : '[MISSING]'));
            
            try {
                addDebug('Making fetch request to /api/auth/login...');
                
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                addDebug('Response received - Status: ' + response.status);
                addDebug('Response headers: ' + JSON.stringify([...response.headers.entries()]));
                
                const text = await response.text();
                addDebug('Response text length: ' + text.length);
                
                if (response.ok) {
                    const user = JSON.parse(text);
                    addDebug('Parsed user object: ' + JSON.stringify(user));
                    addDebug('Token present: ' + (user.token ? 'YES' : 'NO'));
                    
                    result.innerHTML = '<div class="success"><strong>‚úÖ Login Successful!</strong><br>' +
                                     'User: ' + user.email + '<br>' +
                                     'Token: ' + (user.token ? user.token.substring(0, 20) + '...' : 'MISSING') + '</div>';
                                     
                    // Test if we can store the token
                    try {
                        localStorage.setItem('bjj_auth_token', user.token);
                        addDebug('Token stored in localStorage successfully');
                        
                        // Test if we can retrieve it
                        const retrieved = localStorage.getItem('bjj_auth_token');
                        addDebug('Token retrieved from localStorage: ' + (retrieved ? 'YES' : 'NO'));
                    } catch (error) {
                        addDebug('Error storing token: ' + error.message);
                    }
                } else {
                    addDebug('Login failed with error text: ' + text);
                    result.innerHTML = '<div class="error"><strong>‚ùå Login Failed</strong><br>' + text + '</div>';
                }
            } catch (error) {
                addDebug('Network or JavaScript error: ' + error.message);
                result.innerHTML = '<div class="error"><strong>‚ùå Network Error</strong><br>' + error.message + '</div>';
            }
        });
        
        // Test initial page load
        addDebug('Debug page loaded successfully');
        addDebug('Current URL: ' + window.location.href);
        addDebug('Local storage available: ' + (typeof localStorage !== 'undefined' ? 'YES' : 'NO'));
    </script>
</body>
</html>